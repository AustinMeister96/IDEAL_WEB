<div class="space-below">
  <div class="row">
     
      <strong>CT Scan Date:</strong> {{ form.ct_scan_date }}
    </div>
     
      <strong>CT Scan Visit ID:</strong> {{ form.ct_scan_visitID }}
    </div>
     
      <strong>CT Scan Location:</strong> {{ form.ct_scan_location }}
    </div>
  </div>
  <div class="row">
     
      <strong>CT Scan Family History:</strong> {{ form.ct_scan_familty_history }}
    </div>
     
      <strong>CT Scan PT Lung Cancer:</strong> {{ form.ct_scan_pt_lung_cancer }}
    </div>
     
      <strong>DLP (mGy-cm):</strong> {{ form.ct_scan_dlp }}
    </div>
  </div>
  <div class="row">
    <div class="col-6">
      <strong class="bold-and-large">Radiologist</strong>
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
    <div class="col-6">
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
  </div>
  <div class="row">
     
      <strong>Radiologist:</strong> {{ form.ct_scan_radiologist }}
    </div>
     
      <strong>Review Date:</strong> {{ form.ct_scan_review_date }}
    </div>
     
      <strong>Follow-up Months:</strong> {{ form.radiologist_fu_mnths }}
    </div>
     
      <strong>Follow-up Date:</strong> {{ form.radiologist_fu_mnths_date }}
    </div>
  </div>
  <div class="row">
    <div class="col-6">
      <strong class="bold-and-large">CAD</strong>
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
    <div class="col-6">
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
  </div>
  <div class="row">
     
      <strong>Follow-up Months:</strong> {{ form.cad_fu_mnths }}
    </div>
     
      <strong>Follow-up Date:</strong> {{ form.cad_fu_mnths_date }}
    </div>
  </div>
  <div class="row">
    <div class="col-6">
      <strong class="bold-and-large">Final</strong>
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
    <div class="col-6">
      <label class="invisible-label">_____</label>
      <label class="invisible-label">_____</label>
    </div>
  </div>
  <div class="row">
     
      <strong>ILST Category:</strong> {{ form.ilst_cat }}
    </div>
     
      <strong>Final Rec Follow-up Months:</strong> {{ form.final_rec_fu_mnths }}
    </div>
     
      <strong>Follow-up Date:</strong> {{ form.final_rec_fu_mnths_date }}
    </div>
  </div>
</div>

<div class="row">
  <div class="col-6">
    <strong class="bold-and-large">COPD</strong>
    <label class="invisible-label">_____</label>
    <label class="invisible-label">_____</label>
  </div>
  <div class="col-6">
    <label class="invisible-label">_____</label>
    <label class="invisible-label">_____</label>
  </div>
</div>
<div class="row">
   
    <strong>Emphysema:</strong>
    {{ form.copd_emphysema.0 }}
    {{ form.copd_emphysema.1 }}
    {{ form.copd_emphysema.2 }}
    {{ form.copd_emphysema.3 }}
    {{ form.copd_emphysema.4 }}
  </div>
   
    <label class="invisible-label">_____</label>
    <label class="invisible-label">_____</label>
  </div>
   
    <label class="invisible-label">_____</label>
    <label class="invisible-label">_____</label>
  </div>
</div>
<div class="row">
   
    <strong>Emphysema Extent:</strong>
    {{ form.copd_emphysema_extent.0 }}
    {{ form.copd_emphysema_extent.1 }}
    {{ form.copd_emphysema_extent.2 }}
    {{ form.copd_emphysema_extent.3 }}
    {{ form.copd_emphysema_extent.4 }}
    {{ form.copd_emphysema_extent.5 }}
  </div>
   
    <label class="invisible-label">_____</label>
    <label class="invisible-label">_____</label>
  </div>
</div>
<div class="row">
   
    <strong>Emphysema Type:</strong>
    {{ form.copd_emphysema_type.0 }}
    {{ form.copd_emphysema_type.1 }}
    {{ form.copd_emphysema_type.2 }}
    {{ form.copd_emphysema_type.3 }}
  </div>
</div>
<div class="row">
   
    <strong>Ditribution of Emphysema:</strong>
    {{ form.copd_emphysema_distribution.0 }}
    {{ form.copd_emphysema_distribution.1 }}
    {{ form.copd_emphysema_distribution.2 }}
    {{ form.copd_emphysema_distribution.3 }}
  </div>
</div>

<div class="row">
   
    <strong>Cor Art Calc:</strong>
    {{ form.cor_art_calc.1 }}
    {{ form.cor_art_calc.2 }}
    {{ form.cor_art_calc.3 }}
    {{ form.cor_art_calc.4 }}
    {{ form.cor_art_calc.5 }}
    <label class="invisible-label">_____</label>
  </div>
   
    <strong>Cor Art Agatson:</strong> {{ form.cor_art_agatson }}
  </div>
</div>
<div class="row">
   
    <strong>Airways:</strong>
    {{ form.airways.0 }}
    {{ form.airways.1 }}
  </div>
   
    <strong>Airways Type:</strong>
    {{ form.airways_type.0 }}
    {{ form.airways_type.1 }}
    {{ form.airways_type.2 }}
    {{ form.airways_type.3 }}
    {{ form.airways_type.4 }}
  </div>
</div>
<div class="row">
   
    <strong>Actionable Findings:</strong>
    {{ form.cat_5_findings.0 }}
    {{ form.cat_5_findings.1 }}
    {{ form.cat_5_findings.2 }}
  </div>
   
    <strong>Cat 5 Comments:</strong> {{ form.cat_5_comments }}
  </div>
</div>
<div class="row">
   
    <label class="invisible-label">__</label>
  </div>
   </div>
   </div>
   </div>
</div>

<div class="row">
   
    <strong class="bold-and-large">Other Findings</strong>
  </div>
   
    <strong class="bold-and-large">Comments</strong>
  </div>
   
    <strong class="bold-and-large">Comments</strong>
  </div>
</div>
<div class="row">
   
    <strong>Cardiovascular:</strong> {{ form.other_cardiovascular }}
  </div>
   
    {{ form.other_cardiovascular_comments }}
  </div>
   
    <strong>Musculoskeletal:</strong> {{ form.other_vertebral }}
  </div>
   
    {{ form.other_vertebral_comments }}
  </div>
</div>
<div class="row">
   
    <strong>GI:</strong> {{ form.other_GI }}
  </div>
   
    {{ form.other_GI_comments }}
  </div>
   
    <strong>Breast:</strong> {{ form.other_breast }}
  </div>
   
    {{ form.other_breast_comments }}
  </div>
</div>
<div class="row">
   
    <strong>Endocrine:</strong> {{ form.other_endocrine }}
  </div>
   
    {{ form.other_endocrine_comments }}
  </div>
   
    <strong>Other Lymph:</strong> {{ form.other_lymph }}
  </div>
   
    {{ form.other_lymph_comments }}
  </div>
</div>
<div class="row">
   
    <strong>Pulmonary Fibrosis:</strong> {{ form.other_pulmonary_fibrosis }}
  </div>
   
    {{ form.other_pulmonary_fibrosis_comments }}
  </div>
   
    <strong>Musculoskeletal:</strong> {{ form.other_musculoskeletal }}
  </div>
   
    {{ form.other_musculoskeletal_comments }}
  </div>
</div>
<div class="row">
   
    <strong>Other:</strong> {{ form.other_other }}
  </div>
   
    {{ form.other_other_comments }}
  </div>
   
    <strong>Pleura:</strong> {{ form.other_pleura }}
  </div>
   
    {{ form.other_pleura_comments }}
  </div>
</div>
<div class="row">
   </div>
   {{ form.pleural_effusion_comments.effusion }} {{ form.pleural_effusion_comments.asbestos }}</div>
</div>
<div class="row">
   
    <strong>General Comments:</strong> {{ form.general_comments }}
  </div>
</div>










<label class="bold-text">Emphysema Type:</label>
{{ ct_scan_form.copd_emphysema_type.0 }}
{{ ct_scan_form.copd_emphysema_type.1 }}
{{ ct_scan_form.copd_emphysema_type.2 }}
{{ ct_scan_form.copd_emphysema_type.3 }}















{% csrf_token %}
<table>
    <tbody class="space-below">

      <tr>
        <th scope="row">CT Scan Date:</th>
        <td>{{ ct_scan_form.ct_scan_date }}</td>
        <th scope="row">CT Scan Visit ID:</th>
        <td>{{ ct_scan_form.ct_scan_visitID }}</td>
        <th scope="row">CT Scan Location:</th>
        <td>{{ ct_scan_form.ct_scan_location }}</td>
      </tr>
      <tr>
        <th scope="row">CT Scan Family History:</th>
        <td>{{ ct_scan_form.ct_scan_familty_history }}</td>
        <th scope="row">CT Scan PT Lung Cancer:</th>
        <td>{{ ct_scan_form.ct_scan_pt_lung_cancer }}</td>
        <th scope="row">DLP (mGy-cm):</th>
        <td>{{ ct_scan_form.ct_scan_dlp }}</td>

      </tr>
      <tr>
        <th class='bold-and-large'scope="row">Radiologist</th>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
    </tr>
      <tr>
        <th scope="row">Radiologist:</th>
        <td>{{ ct_scan_form.ct_scan_radiologist }}</td>
        <th scope="row">Review Date:</th>
        <td>{{ ct_scan_form.ct_scan_review_date }}</td>
        <th scope="row">Follow-up Months:</th>
        <td>{{ ct_scan_form.radiologist_fu_mnths }}</td>
        <th scope="row">Follow-up Date:</th>
        <td>{{ ct_scan_form.radiologist_fu_mnths_date }}</td>

      </tr>
      <tr>
        <th class='bold-and-large'scope="row">CAD</th>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
       </tr>
      <tr>
        <th scope="row">Follow-up Months:</th>
        <td>{{ ct_scan_form.cad_fu_mnths }}</td>
        <th scope="row">Follow-up Date:</th>
        <td>{{ ct_scan_form.cad_fu_mnths_date }}</td>
      </tr>
      <tr>
        <th class='bold-and-large'scope="row">Final</th>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
        <td>
            <label class="invisible-label">_____</label>
            <label class="invisible-label">_____</label>
        </td>
       </tr>
    <tr>
        <th scope="row">ILST Category:</th>
        <td>{{ ct_scan_form.ilst_cat }}</td>
        <th scope="row">Final Rec Follow-up Months:</th>
        <td>{{ ct_scan_form.final_rec_fu_mnths }}</td>
        <th scope="row">Follow-up Date:</th>
        <td>{{ ct_scan_form.final_rec_fu_mnths_date }}</td>
    </tr>
</tbody>
</table> 

</br>   

<div class="justify-content-center">
    <div class="container-border">
        <div class="container-fluid">
            <div class="row gx-1 justify-content-center align-items-stretch">
                <div class="copd-size d-flex flex-column flex-md-wrap black-border ">
                    
                    <label class="bold-text">Emphysema:</label>
                        <div>{{ ct_scan_form.copd_emphysema.0 }}</div>
                        <div>{{ ct_scan_form.copd_emphysema.1 }}</div>
                        <div>{{ ct_scan_form.copd_emphysema.2 }}</div>
                        <div>{{ ct_scan_form.copd_emphysema.3 }}</div>
                        <div>{{ ct_scan_form.copd_emphysema.4 }}</div>
                </div>

                <div class="emphysema-size d-flex flex-column flex-md-wrap black-border">
                    <label class="bold-text">Emphysema Extent:</label>
                    {{ ct_scan_form.copd_emphysema_extent.0 }}
                    {{ ct_scan_form.copd_emphysema_extent.1 }}
                    {{ ct_scan_form.copd_emphysema_extent.2 }}
                    {{ ct_scan_form.copd_emphysema_extent.3 }}
                    {{ ct_scan_form.copd_emphysema_extent.4 }}
                    {{ ct_scan_form.copd_emphysema_extent.5 }}
                </div>

                <div class="emphysema-extent-size d-flex flex-column black-border">
                    <label class="bold-text">Emphysema Type:</label>
                    {{ ct_scan_form.copd_emphysema_type.0 }}
                    {{ ct_scan_form.copd_emphysema_type.1 }}
                    {{ ct_scan_form.copd_emphysema_type.2 }}
                    {{ ct_scan_form.copd_emphysema_type.3 }}
                    <label>Ditribution of Emphysema:</label>
                    {{ct_scan_form.copd_emphysema_distribution.0}}
                    {{ct_scan_form.copd_emphysema_distribution.1}}
                    {{ct_scan_form.copd_emphysema_distribution.2}}
                    {{ct_scan_form.copd_emphysema_distribution.3}}
                </div>

                <div class="cor-art-size d-flex flex-wrap black-border">
                    <label class="bold-text">Cor Art Calc:</label>
                    {{ ct_scan_form.cor_art_calc.1 }}
                    {{ ct_scan_form.cor_art_calc.2 }}
                    {{ ct_scan_form.cor_art_calc.3 }}
                    {{ ct_scan_form.cor_art_calc.4 }}
                    {{ ct_scan_form.cor_art_calc.5 }}
                    <label>Cor Art Agatson:</label>
                    <center><div>{{ ct_scan_form.cor_art_agatson }}</div></center>
                    
                </div>
                
                <div class="airways-size d-flex flex-wrap black-border">
                    <label class="bold-text">Airways:</labeL>
                    <div>
                        {{ ct_scan_form.airways.0 }}
                        {{ ct_scan_form.airways.1 }}
                    </div>
                    <label class="bold-text">Airways Type:</labeL>
                    {{ ct_scan_form.airways_type.0 }}
                    {{ ct_scan_form.airways_type.1 }}
                    {{ ct_scan_form.airways_type.2 }}
                    {{ ct_scan_form.airways_type.3 }}
                    {{ ct_scan_form.airways_type.4 }}

                        
                </div>

                <div class="actionable-size d-flex flex-wrap black-border">
                    <label class="bold-text">Actionable Findings:</label>
                    {{ ct_scan_form.cat_5_findings.0 }}
                    {{ ct_scan_form.cat_5_findings.1 }}
                    {{ ct_scan_form.cat_5_findings.2 }}
                    <label>Cat 5 Comments:<label>
                        {{ ct_scan_form.cat_5_comments }}

                </div>
                    
                <div class=" d-flex flex-wrap black-border mb1">

                        
                </div>

            </div>
        </div>
    </div>
</div>
    <br>
    <center>
    <table>
    <tbody>
      <tr>
        <th scope="row" class="bold-and-large">Other Findings</th>
        <td></td>
        <th scope="row" class="bold-and-large">Comments</th>
        <td></td>
        <th scope="row" class="bold-and-large">Other Findings</th>
        <td class="bold-and-large">Comments</td>
        <th class="bold-and-large">Other Findings</th>
        <td></td>  
        <th scope="row" class="bold-and-large">Comments</th>
        <td></td> 

      </tr>
      <tr>
        <th scope="row">Cardiovascular:</th>
        <td>{{ ct_scan_form.other_cardiovascular }}</td>
        <td>{{ ct_scan_form.other_cardiovascular_comments }}</td>

        <th scope="row">Musculoskeletal:</th>
        <td>{{ ct_scan_form.other_vertebral }}</td>
        
        <td>{{ ct_scan_form.other_vertebral_comments }}</td>
        <th scope="row">GI:</th>
        <td>{{ ct_scan_form.other_GI }}</td>
        
        <td>{{ ct_scan_form.other_GI_comments }}</td>

      </tr>

      <tr>
        <th scope="row"> Endocrine:</th>
        <td>{{ ct_scan_form.other_endocrine }}</td>
        
        <td>{{ ct_scan_form.other_endocrine_comments }}</td>
        <th scope="row">Other Lymph:</th>
        <td>{{ ct_scan_form.other_lymph }}</td>
        
        <td>{{ ct_scan_form.other_lymph_comments }}</td>
        <th scope="row">Pulmonary Fibrosis:</th>
        <td>{{ ct_scan_form.other_pulmonary_fibrosis }}</td>
        
        <td>{{ ct_scan_form.other_pulmonary_fibrosis_comments }}</td>

      </tr>




      </tr>
      <tr>
        <th scope="row">Breast:</th>
        <td>{{ ct_scan_form.other_breast }}</td>
        
        <td>{{ ct_scan_form.other_breast_comments }}</td>
        <th scope="row">Other:</th>
        <td>{{ ct_scan_form.other_other }}</td>
        <td>{{ ct_scan_form.other_other_comments }}</td>
        <th scope="row">Pleura:</th>
        <td>{{ ct_scan_form.other_pleura }}</td>
        
        <td>{{ ct_scan_form.other_pleura_comments }}</td>
        
        <td>{{ ct_scan_form.pleural_effusion_comments.effusion }} {{ ct_scan_form.pleural_effusion_comments.asbestos }}</td>
      </tr>
      <tr>
        <th scope="row">Musculoskeletal:</th>
        <td>{{ ct_scan_form.other_musculoskeletal }}</td>
        
        <td>{{ ct_scan_form.other_musculoskeletal_comments }}</td>
      <th scope="row">General Comments:</th>
        <td colspan="3">{{ ct_scan_form.general_comments }}</td>
      </tr>

      <tr>

      </tr>
      <tr>
    </tbody>
  </table>
    </center>
<button stlye="align-right" type="submit">Save</button>










<nav class="sticky-top navbar navbar-expand-lg navbar-light bg-light">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>
  <div class="container-fluid">
      <a class="navbar-brand" href="#">
          <img src="/static/ideal_logo.png" alt="IDEAL Logo" height="75">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/">Home</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Questionnaires
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="/DataEntry/add_mandatory_questionaire/">Mandatory Questionaire</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_mandatory_questionaire/">Mandatory Part A-B</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_mandatory_questionaire_c/">Mandatory Part C</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_mandatory_questionaire_de/">Mandatory Part D-G</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_exposure_form/">Optional Questionnaire</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_yearly_update/">Yearly Update</a></li>
                    <li><a class="dropdown-item" href="/DataEntry/add_inclusion/">Inclusion</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown"></li>
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Samples </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><a class="nav-link active" aria-current="page" href="/DataEntry/add_breath_collection">Breath Collection</a></li>
                    <li><a class="nav-link active" aria-current="page" href="/DataEntry/add_ct_scans/1234567">CT Scans</a></li>
                    <li><a class="nav-link active" aria-current="page" href="/DataEntry/add_blood_collection">Blood Collection</a></li>
                    <li><a class="nav-link active" aria-current="page" href="/DataEntry/PLCO_score">PLCO Score</a></li>
    
                </ul>
              </li>


              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/add_breath_collection">Breath Collection</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/add_ct_scans/1234567">CT Scans</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/add_blood_collection">Blood Collection</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/add_lab_processing">Lab</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/PLCO_score">PLCO Score</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/DataEntry/add_protocol_deviations">Protocol Deviations</a>
              </li>

          </ul>
          <div class="d-flex align-items-center">
            <label for="participant-number">Participant Number</label>
            <label for="participant-name">Participant Name</label>
            <label for="participant-dob">Participant Date of Birth</label>
            <div class="search-bar">
              <input type="text" id="participant-number" placeholder="Enter participant number">
              <button type="submit">Search</button>
            </div>
          </div>
        </div> 
        </div>
      </div>
  </div>

</nav>





<script>
  $(document).ready(function() {
    // Function to update participant status
    function updateParticipantStatus() {
      // Collect form data
      var formData = $('#updateParticipantStatusForm').serialize();

      // Send AJAX request
      $.ajax({
        url: '/DataEntry/update_participant_status/',
        type: 'POST',
        data: formData,
        success: function(response) {
          // Update participant status dynamically
          $('#participantStatus').text(response.participant_status);
        }
      });
    }

    // Listen for changes in inclusion criteria fields
    $('.inclusion-criteria').on('change', function() {
      updateParticipantStatus();
    });

    // Initial update on page load
    updateParticipantStatus();
  });

  $(document).on('submit', '#post-form', function(e) {
      e.preventDefault();
      $.ajax({
          type:'POST',
          url:'inclusion.html',
          data:{
              participant_num:$('#participant_num').val(),

              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
          },
          success:function(){
              alert("Form submitted successfully");
          }
      });
  });
</script>

<script>
$(document).ready(function() {
  // Disable the submit button initially
  $('#submitFormsButton').prop('disabled', true);

  // When both forms are valid, enable the submit button
  $('#participantForm, #inclusionForm').on('change', function() {
    if ($('#participantForm')[0].checkValidity() && $('#inclusionForm')[0].checkValidity()) {
      $('#submitFormsButton').prop('disabled', false);
    } else {
      $('#submitFormsButton').prop('disabled', true);
    }
  });

  // Handle the click event of the submit button
  $('#submitFormsButton').on('click', function() {
    // Submit the participant form first
    $.ajax({
      url: '{% url "add_participant" %}',  // Replace with the URL to handle the participant form submission
      type: 'post',
      data: $('#participantForm').serialize(),
      success: function(response) {
        // If the participant form is submitted successfully, submit the inclusion form
        $.ajax({
          url: '{% url "add_inclusion" %}',  // Replace with the URL to handle the inclusion form submission
          type: 'post',
          data: $('#inclusionForm').serialize(),
          success: function(response) {
            // Both forms submitted successfully, redirect to the next page
            window.location.href = '/DataEntry/add_mandatory_questionaire';  // Replace with the URL of the next page after form submission
          },
          error: function(error) {
            console.log('Error submitting inclusion form:', error);
          }
        });
      },
      error: function(error) {
        console.log('Error submitting participant form:', error);
      }
    });
  });
});
</script>









mandatory questionaire form page:
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Hide the gender_identity_other field and label initially
        $("#id_gender_identity_other").hide();
        $("label[for='id_gender_identity_other']").hide();
    
        // Add event listener to gender_identity field
        $("#id_gender_identity").change(function() {
            var selectedValue = $(this).val();
    
            // Check if 'Other' is selected
            if (selectedValue === "Other") {
                $("#id_gender_identity_other").show();
                $("label[for='id_gender_identity_other']").show();
            } else {
                $("#id_gender_identity_other").hide();
                $("label[for='id_gender_identity_other']").hide();
            }
        
        
        });

        
        $("#id_ethnicity_other").hide();
        $("label[for='id_ethnicity_other']").hide();
    
        // Add event listener to gender_identity field
        $("#id_ethnicity").change(function() {
            var selectedValue = $(this).val();
    
            // Check if 'Other' is selected
            if (selectedValue === "Other") {
                $("#id_ethnicity_other").show();
                $("label[for='id_ethnicity_other']").show();
            } else {
                $("#id_ethnicity_other").hide();
                $("label[for='id_ethnicity_other']").hide();
            }
        
        
        });

        $("#id_year_moved_to_canada").hide();
        $("label[for='id_year_moved_to_canada']").hide();

        $("#id_birthplace").hide();
        $("label[for='id_birthplace']").hide();
    
        // Add event listener to gender_identity field
        $("#id_born_in_canada").change(function() {
            var selectedValue = $(this).val();
    
            // Check if 'Other' is selected
            if (selectedValue === "No") {
                $("#id_year_moved_to_canada").show();
                $("label[for='id_year_moved_to_canada']").show();
                $("#id_birthplace").show();
                $("label[for='id_birthplace']").show();

            } else {
                $("#id_year_moved_to_canada").hide();
                $("label[for='id_year_moved_to_canada']").hide();
                $("#id_birthplace").hide();
                $("label[for='id_birthplace']").hide();
            }
        
        
        });

        $("#id_highest_education_lvl_other").hide();
        $("label[for='id_highest_education_lvl_other']").hide();
    
        // Add event listener to gender_identity field
        $("#id_highest_education_lvl").change(function() {
            var selectedValue = $(this).val();
    
            // Check if 'Other' is selected
            if (selectedValue === "Other") {
                $("#id_highest_education_lvl_other").show();
                $("label[for='id_highest_education_lvl_other']").show();
            } else {
                $("#id_highest_education_lvl_other").hide();
                $("label[for='id_highest_education_lvl_other']").hide();
            }
        
        
        });

        $("#id_personal_cancer_history_youngest_age").hide();
        $("label[for='id_personal_cancer_history_youngest_age']").hide();
        $("#id_personal_history_cancer_type").hide();
        $("label[for='id_personal_history_cancer_type']").hide();

        // Add event listener to gender_identity field
        $("#id_personal_cancer_history").change(function() {    

            if ($(this).val() === 'True') {
                $("#id_personal_cancer_history_youngest_age").show();
                $("label[for='id_personal_cancer_history_youngest_age']").show();
                $("#id_personal_history_cancer_type").show();
                $("label[for='id_personal_history_cancer_type']").show();
            } else {
                $("#id_personal_cancer_history_youngest_age").hide();
                $("label[for='id_personal_cancer_history_youngest_age']").hide();
                $("#id_personal_history_cancer_type").hide();
                $("label[for='id_personal_history_cancer_type']").hide();
            }
        
        
        });



        $(document).ready(function() {
        var formCount = 1;

        $('#add-row-btn').click(function() {
                var newForm = `
                <p><label for="id_form-${formCount}-biological_rel">Biological Relationship:</label>
                <input type="text" name="form-${formCount}-biological_rel" required id="id_form-${formCount}-biological_rel"></p>
                
                <p><label for="id_form-${formCount}-type_of_cancer">Type of Cancer:</label>
                <input type="text" name="form-${formCount}-type_of_cancer" required id="id_form-${formCount}-type_of_cancer"></p>
                
                <p><label for="id_form-${formCount}-age_diagnosis">Age at Diagnosis:</label>
                <input type="text" name="form-${formCount}-age_diagnosis" required id="id_form-${formCount}-age_diagnosis"></p>
            `;
            $('#cancer-history-forms').append(newForm);
            formCount++;
        });
        $(document).on('click', '.remove-row-btn', function() {
            $(this).closest('.cancer-history-form-row').remove();
        });

        // Remove the most recent row
        $('#remove-most-recent-btn').click(function() {
            $('.cancer-history-form-row').last().remove();
        });
    });
});

</script>





from mandatory questionaire form page:
<div class="form-group">
  <label class="yes_no" for="{{ form.copd.id_for_label }}">COPD</label>
  <div class="form-check form-check-inline">
  {{ form.copd.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.copd.1 }}
  </div>
  <label class="yes_no" for="{{ form.emphysema.id_for_label }}">Emphysema</label>
  <div class="form-check form-check-inline">
  {{ form.emphysema.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.emphysema.1 }}
  </div>
  <label class="yes_no" for="{{ form.chronic_bronchitis.id_for_label }}">Chronic Bronchitis</label>
  <div class="form-check form-check-inline">
  {{ form.chronic_bronchitis.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.chronic_bronchitis.1 }}
  </div>
  <label class="yes_no" for="{{ form.asthma.id_for_label }}">Asthma</label>
  <div class="form-check form-check-inline">
  {{ form.asthma.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.asthma.1 }}
</div>
  <label class="yes_no" for="{{ form.diabetes.id_for_label }}">Diabetes</label>
  <div class="form-check form-check-inline">
  {{ form.diabetes.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.diabetes.1 }}
  </div>
  <label class="yes_no" for="{{ form.hypertension.id_for_label }}">Hypertension</label>
  <div class="form-check form-check-inline">
  {{ form.hypertension.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.hypertension.1 }}
  </div>
</div>

<!-- Tuberculosis -->
<div class="form-group">
  <label class="yes_no" for="{{ form.tuberculosis.id_for_label }}">Tuberculosis</label>
  <div class="form-check form-check-inline">
  {{ form.tuberculosis.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.tuberculosis.1 }}
  </div>
  <label class="yes_no" for="{{ form.adult_pneumonia.id_for_label }}">Adult Pneumonia</label>
  <div class="form-check form-check-inline">
  {{ form.adult_pneumonia.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.adult_pneumonia.1 }}
  </div>
  <label class="yes_no" for="{{ form.pulmonary_fibrosis.id_for_label }}">Pulmonary Fibrosis</label>
  <div class="form-check form-check-inline">
  {{ form.pulmonary_fibrosis.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.pulmonary_fibrosis.1 }}
  </div>
  <label class="yes_no" for="{{ form.hiv.id_for_label }}">HIV</label>
  <div class="form-check form-check-inline">
  {{ form.hiv.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.hiv.1 }}
  </div>  
  <label class="yes_no" for="{{ form.long_covid.id_for_label }}">Long COVID</label>
  <div class="form-check form-check-inline">
  {{ form.long_covid.0 }}
  </div>
  <div class="form-check form-check-inline">
  {{ form.long_covid.1 }}
  </div>
</div>
<div class="test-label">
  
</div>





old mandatory views:




def add_mandatory_questionaire_2(request, participant_id=None):
    form = Mandatory_questionaire_form(request.POST or None)
    cancer_form = CancerHistoryForm()
    filled_form = Mandatory_questionaire_form(request.GET)
    if id != None:
        if request.method == 'POST':
            if form.is_valid():
                form.save()
                return HttpResponse('/mandatory_questionaire/?submitted=True')
        
        if request.method == 'GET':
            form = Mandatory_questionaire_form()
            filled_form = Mandatory_questionaire_form(request.GET)
            if filled_form.is_valid():
                participant_num = filled_form.cleaned
        return render(request, 'DataEntry/mandatory_questionaire.html', {'form': form, 'cancer_form': cancer_form})
    else:
        if request.method == 'POST':
            if form.is_valid():
                form.save()
                return HttpResponse('/mandatory_questionaire/?submitted=True')
        
        if request.method == 'GET':
            form = Mandatory_questionaire_form()
            filled_form = Mandatory_questionaire_form(request.GET)
            if filled_form.is_valid():
                participant_num = filled_form.cleaned


    context = {
        'form': form,
        'cancer_form': cancer_form
    }
    
    return render(request, 'DataEntry/mandatory_questionaire.html', context)


    def add_mandatory_questionaire_aug4(request, participant_id=None):
    participant = None
    Mandatory_questionaire_data = None

    if participant_id is not None:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        Mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()

    if request.method == 'POST':
        form = Mandatory_questionaire_form(request.POST, instance=Mandatory_questionaire_data)

        if form.is_valid():

            participant = Participant.objects.create(participant_number=participant_id)
            mandatory_questionnaire = Mandatory_questionaire.objects.create(participant_num=participant)
            Mandatory_questionaire_data.participant_num = participant.pk
            form.instance = mandatory_questionnaire
            form.save()
            return HttpResponse('/mandatory_questionaire/?submitted=True')
    else:
        if participant is None and participant_id is not None:
            participant = Participant.objects.create(participant_number=participant_id)
        form = Mandatory_questionaire_form(instance=Mandatory_questionaire_data)

    context = {
        'form': form,
        'cancer_form': CancerHistoryForm(),  # Assuming you have a CancerHistoryForm
    }
    
    print(form.errors)
    return render(request, 'DataEntry/mandatory_questionaire.html', context)




    def add_mandatory_questionaire_oldAug6NotWorking(request, participant_id=None):
    participant = None
    mandatory_questionaire_data = None
    print("View accessed!")
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()

    if request.method == 'POST' and 'submit' in request.POST:
        form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
        
        if form.is_valid():
            print("Form is valid!") 
            mandatory_questionaire = form.save(commit=False)
            
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire.participant_num = participant
            mandatory_questionaire.save()
            return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
    else:
        print("Form is NOT valid!")  # Add this line
        form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
        print(form.errors)

    context = {
        'form': form,
        'cancer_form': CancerHistoryForm(),
        'participant_id': participant_id,
    }
    
    print(form.errors)

    RelativeCancerFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)
    if request.method == 'POST':
        formset = biological_relatives_with_cancer(request.POST, prefix='relatives')
        if formset.is_valid():
            # save the formset
            instances = formset.save(commit=False)
            for instance in instances:
                instance.mandatory_questionaire = mandatory_questionaire
                instance.save()
            return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
    else:
        formset = biological_relatives_with_cancer_form(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
    context['formset'] = formset
    return render(request, 'DataEntry/mandatory_questionaire.html', context)




    def add_mandatory_questionaire_2(request, participant_id=None):
    participant = None
    mandatory_questionaire_data = None

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()
    
    BiologicalRelativesFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)

    if request.method == 'POST':
        form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
        formset = BiologicalRelativesFormSet(request.POST, prefix='relatives')
        
        if form.is_valid() and formset.is_valid():
            mandatory_questionaire = form.save(commit=False)
            
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire.participant_num = participant
            mandatory_questionaire.save()
            
            instances = formset.save(commit=False)
            for instance in instances:
                instance.mandatory_questionaire = mandatory_questionaire
                instance.save()

            return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
    else:
        form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
        formset = BiologicalRelativesFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
    
    context = {
        'form': form,
        'formset': formset,
        'participant_id': participant_id,
    }

    return render(request, 'DataEntry/mandatory_questionaire.html', context)


    
def add_mandatory_questionaire_working_ish(request, participant_id=None):
participant = None
mandatory_questionaire_data = None
print("View accessed!")
if participant_id:
    participant = get_object_or_404(Participant, participant_number=participant_id)
    mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()

RelativeCancerFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)

if request.method == 'POST' and 'submit' in request.POST:
    form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
    formset = RelativeCancerFormSet(request.POST, prefix='relatives')

    if form.is_valid() and formset.is_valid():
        print("Form is valid!") 
        mandatory_questionaire = form.save(commit=False)

        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
        
        mandatory_questionaire.participant_num = participant
        mandatory_questionaire.save()

        instances = formset.save(commit=False)
        for instance in instances:
            instance.mandatory_questionaire = mandatory_questionaire
            instance.save()

        return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
else:
    print("Form is NOT valid!")  
    form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
    formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
    print(form.errors)

context = {
    'form': form,
    'formset': formset,
    'participant_id': participant_id,
}
print(form.errors)
return render(request, 'DataEntry/mandatory_questionaire.html', context)




class MandatoryQuestionaireView(UpdateView):
    model = Mandatory_questionaire
    form_class = Mandatory_questionaire_form
    template_name = 'DataEntry/mandatory_questionaire.html'
    
    def get_object(self, queryset=None):
        # This method retrieves the object, if it exists, or prepares a new one
        if self.kwargs.get('participant_id'):
            participant = get_object_or_404(Participant, participant_number=self.kwargs['participant_id'])
            return Mandatory_questionaire.objects.filter(participant_num=participant).first()
        return None

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        
        if self.object:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.filter(mandatory_questionaire=self.object), prefix='relatives')
        else:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')

        context['formset'] = formset
        context['participant_id'] = self.kwargs['participant_id']
        return context

    def form_valid(self, form):
        context = self.get_context_data()
        formset = context['formset']

        if formset.is_valid():
            # Save the main form
            mandatory_questionaire = form.save(commit=False)
            
            if not self.object:
                participant, _ = Participant.objects.get_or_create(participant_number=self.kwargs['participant_id'])
                mandatory_questionaire.participant_num = participant

            mandatory_questionaire.save()

            # Save the formset
            instances = formset.save(commit=False)
            for instance in instances:
                instance.mandatory_questionaire = mandatory_questionaire
                instance.save()
            return HttpResponseRedirect(self.get_success_url())

        return super().form_invalid(form)

    def get_success_url(self):
        return reverse('add_mandatory_questionaire', args=[self.kwargs['participant_id']]) + '?submitted=True'





def add_mandatory_questionaire(request, participant_id=None):
    print(request.POST)
    
    participant = None
    mandatory_questionaire_data = None
    print("View accessed!")
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()
        print(participant)
    RelativeCancerFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)
    #
    if request.method == 'POST':
        form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
        formset = RelativeCancerFormSet(request.POST, prefix='relatives')

        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)

        mandatory_questionaire = form.save(commit=False)
        mandatory_questionaire.participant_num = participant
        #if form.is_valid() and formset.is_valid():
        if form.is_valid():
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire = form.save(commit=False)
            mandatory_questionaire.participant_num = participant

            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire.participant_num = participant
            print("Participant to be associated:", participant)
            print("Mandatory questionnaire before save:", mandatory_questionaire.participant_num)
            mandatory_questionaire.save()

            instances = formset.save(commit=False)
            for instance in instances:
                instance.mandatory_questionaire = mandatory_questionaire
                instance.save()

            return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
        else:

            print(form.errors)
            #print(formset.errors)
    else:
        print("Form is NOT valid!")  
        form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
        if mandatory_questionaire_data:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.filter(mandatory_questionaire=mandatory_questionaire_data), prefix='relatives')
        else:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
        #print(form.errors)

    context = {
        'form': form,
        'formset': formset,
        'participant_id': participant_id,
    }

    #print(form.errors)
    #print(formset.errors)
    return render(request, 'DataEntry/mandatory_questionaire.html', context)

    <form method="POST" action="{% url 'add_mandatory_questionaire_c' participant_id=participant_id %}" class="in-line">








      def add_mandatory_questionaire_c_old(request, participant_id=None):
      participant = None
      mandatory_questionaire_c_data = None
  
      if participant_id is not None:
          participant = get_object_or_404(Participant, participant_number=participant_id)
          mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
  
      if request.method == 'POST':
          form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)
          if form.is_valid():
              if participant is None and participant_id is not None:
                  participant = Participant.objects.create(participant_number=participant_id)
                  mandatory_questionnaire = Mandatory_questionaire_c.objects.create(participant_num=participant)
                  form.instance = mandatory_questionnaire
              form.save()
              return HttpResponse('/mandatory_questionaire/?submitted=True')
      else:
          if participant is None and participant_id is not None:
              participant = Participant.objects.create(participant_number=participant_id)
          form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)
  
      context = {
          'form': form,
      }
  
      print(form.errors)
      return render(request, 'DataEntry/mandatory_questionaire_c.html', context)
  
  def add_mandatory_questionaire_c_old(request, participant_id=None):
      participant = None
      Mandatory_questionaire_c_data = None
  
      if participant_id is not None:
          participant = get_object_or_404(Participant, participant_number=participant_id)
          Mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
  
      if request.method == 'POST':
          form = Mandatory_questionaire_form_c(request.POST, instance=Mandatory_questionaire_data)
          if form.is_valid():
  
              participant = Participant.objects.create(participant_number=participant_id)
              mandatory_questionnaire = Mandatory_questionaire_c.objects.create(participant_num=participant)
              Mandatory_questionaire_c_data.participant_num = participant.pk
              form.instance = mandatory_questionnaire
              form.save()
              return HttpResponse('/mandatory_questionaire/?submitted=True')
      else:
          if participant is None and participant_id is not None:
              participant = Participant.objects.create(participant_number=participant_id)
          form = Mandatory_questionaire_form_c(instance=Mandatory_questionaire_c_data)
  
      context = {
          'form': form,
      }
      
      print(form.errors)
      return render(request, 'DataEntry/mandatory_questionaire_c.html', context)
  
  
  
  
  
  
  
  
  
  
  
  def add_mandatory_questionaire_c_old(request):
      form = Mandatory_questionaire_form_c(request.POST or None)
      if request.method == 'POST':
          if form.is_valid():
              form.save()
              return HttpResponse('/mandatory_questionaire_c/?submitted=True')
      context = {
          'form': form,
      }
      return render(request, 'DataEntry/mandatory_questionaire_c.html', context) #{'form': form}
  












from mand quest de:
<script>
  $(document).ready(function() {
      // Hide the occupation_fumes field and label initially
      $("#id_occupation_fumes").hide();
      $("label[for='id_occupation_fumes']").hide();
      $("#id_occupation_years").hide();
      $("label[for='id_occupation_years']").hide();

      // Add event listener to occupation_exposure field
      $("input[name='occupation_exposure']").change(function() {
          var selectedValue = $(this).val();

          // Check if 'Yes' is selected
          if (selectedValue === 1) {
              $("#id_occupation_fumes").show();
              $("label[for='id_occupation_fumes']").show();
              $("#id_occupation_years").show();
              $("label[for='id_occupation_years']").show();
          } else {
              $("#id_occupation_fumes").hide();
              $("label[for='id_occupation_fumes']").hide();
              $("#id_occupation_years").hide();
              $("label[for='id_occupation_years']").hide();
          }
      });

      $("#id_ethnicity_other").hide();
      $("label[for='id_ethnicity_other']").hide();
  
      // Add event listener to gender_identity field
      $("#id_ethnicity").change(function() {
          var selectedValue = $(this).val();
  
          // Check if 'Other' is selected
          if (selectedValue === "Other") {
              $("#id_ethnicity_other").show();
              $("label[for='id_ethnicity_other']").show();
          } else {
              $("#id_ethnicity_other").hide();
              $("label[for='id_ethnicity_other']").hide();
          }
      
      
      });

      $("#id_year_moved_to_canada").hide();
      $("label[for='id_year_moved_to_canada']").hide();

      $("#id_birthplace").hide();
      $("label[for='id_birthplace']").hide();
  
      // Add event listener to gender_identity field
      $("#id_born_in_canada").change(function() {
          var selectedValue = $(this).val();
  
          // Check if 'Other' is selected
          if (selectedValue === "No") {
              $("#id_year_moved_to_canada").show();
              $("label[for='id_year_moved_to_canada']").show();
              $("#id_birthplace").show();
              $("label[for='id_birthplace']").show();

          } else {
              $("#id_year_moved_to_canada").hide();
              $("label[for='id_year_moved_to_canada']").hide();
              $("#id_birthplace").hide();
              $("label[for='id_birthplace']").hide();
          }
      
      
      });

      $("#id_highest_education_lvl_other").hide();
      $("label[for='id_highest_education_lvl_other']").hide();
  
      // Add event listener to gender_identity field
      $("#id_highest_education_lvl").change(function() {
          var selectedValue = $(this).val();
  
          // Check if 'Other' is selected
          if (selectedValue === "Other") {
              $("#id_highest_education_lvl_other").show();
              $("label[for='id_highest_education_lvl_other']").show();
          } else {
              $("#id_highest_education_lvl_other").hide();
              $("label[for='id_highest_education_lvl_other']").hide();
          }
      
      
      });

      $("#id_personal_cancer_history_youngest_age").hide();
      $("label[for='id_personal_cancer_history_youngest_age']").hide();
      $("#id_personal_history_cancer_type").hide();
      $("label[for='id_personal_history_cancer_type']").hide();

      // Add event listener to gender_identity field
      $("#id_personal_cancer_history").change(function() {    

          if ($(this).val() === 'True') {
              $("#id_personal_cancer_history_youngest_age").show();
              $("label[for='id_personal_cancer_history_youngest_age']").show();
              $("#id_personal_history_cancer_type").show();
              $("label[for='id_personal_history_cancer_type']").show();
          } else {
              $("#id_personal_cancer_history_youngest_age").hide();
              $("label[for='id_personal_cancer_history_youngest_age']").hide();
              $("#id_personal_history_cancer_type").hide();
              $("label[for='id_personal_history_cancer_type']").hide();
          }
      
      
      });
  });
</script>






table for exposure form cooking:
<table>
  <tr>
    <th>Cooking 0-20 Frequency:</th>
    <th>Cooking 0-20 Frequency Times:</th>
    <th>Cooking 0-20 Fuel:</th>
    <th>Cooking 0-20 Fuel (Other):</th>
    <th>Cooking 0-20 Cooking Oil:</th>
    <th>Cooking 0-20 Cooking Oil (Store):</th>
    <th>Cooking 0-20 Cooking Oil (Homemade):</th>
    <th>Cooking 0-20 Cooking Oil (Other):</th>
    <th>Cooking 0-20 Saute Frequency:</th>
    <th>Cooking 0-20 Fry Frequency:</th>
    <th>Cooking 0-20 Deep Fry Frequency:</th>
  </tr>
  <tr>
    <td>{{ form.cooking_0_20_frequency }}</td>
    <td>{{ form.cooking_0_20_frequency_times }}</td>
    <td>{{ form.cooking_0_20_fuel }}</td>
    <td>{{ form.cooking_0_20_fuel_other }}</td>
    <td>{{ form.cooking_0_20_cooking_oil }}</td>
    <td>{{ form.cooking_0_20_cooking_oil_store }}</td>
    <td>{{ form.cooking_0_20_cooking_oil_homemade }}</td>
    <td>{{ form.cooking_0_20_cooking_oil_other }}</td>
    <td>{{ form.cooking_0_20_saute_frequency }}</td>
    <td>{{ form.cooking_0_20_fry_frequency }}</td>
    <td>{{ form.cooking_0_20_deepfry_frequency }}</td>
  </tr>
  <tr>
    <th>Cooking 21-40 Frequency:</th>
    <th>Cooking 21-40 Frequency Times:</th>
    <th>Cooking 21-40 Fuel:</th>
    <th>Cooking 21-40 Fuel (Other):</th>
    <th>Cooking 21-40 Cooking Oil:</th>
    <th>Cooking 21-40 Cooking Oil (Store):</th>
    <th>Cooking 21-40 Cooking Oil (Homemade):</th>
    <th>Cooking 21-40 Cooking Oil (Other):</th>
    <th>Cooking 21-40 Saute Frequency:</th>
    <th>Cooking 21-40 Fry Frequency:</th>
    <th>Cooking 21-40 Deep Fry Frequency:</th>
  </tr>
  <tr>
    <td>{{ form.cooking_21_40_frequency }}</td>
    <td>{{ form.cooking_21_40_frequency_times }}</td>
    <td>{{ form.cooking_21_40_fuel }}</td>
    <td>{{ form.cooking_21_40_fuel_other }}</td>
    <td>{{ form.cooking_21_40_cooking_oil }}</td>
    <td>{{ form.cooking_21_40_cooking_oil_store }}</td>
    <td>{{ form.cooking_21_40_cooking_oil_homemade }}</td>
    <td>{{ form.cooking_21_40_cooking_oil_other }}</td>
    <td>{{ form.cooking_21_40_saute_frequency }}</td>
    <td>{{ form.cooking_21_40_fry_frequency }}</td>
    <td>{{ form.cooking_21_40_deepfry_frequency }}</td>
  </tr>
  <tr>
    <th>Cooking 41-60 Frequency:</th>
    <th>Cooking 41-60 Frequency Times:</th>
    <th>Cooking 41-60 Fuel:</th>
    <th>Cooking 41-60 Fuel (Other):</th>
    <th>Cooking 41-60 Cooking Oil:</th>
    <th>Cooking 41-60 Cooking Oil (Store):</th>
    <th>Cooking 41-60 Cooking Oil (Homemade):</th>
    <th>Cooking 41-60 Cooking Oil (Other):</th>
    <th>Cooking 41-60 Saute Frequency:</th>
    <th>Cooking 41-60 Fry Frequency:</th>
    <th>Cooking 41-60 Deep Fry Frequency:</th>
  </tr>
  <tr>
    <td>{{ form.cooking_41_60_frequency }}</td>
    <td>{{ form.cooking_41_60_frequency_times }}</td>
    <td>{{ form.cooking_41_60_fuel }}</td>
    <td>{{ form.cooking_41_60_fuel_other }}</td>
    <td>{{ form.cooking_41_60_cooking_oil }}</td>
    <td>{{ form.cooking_41_60_cooking_oil_store }}</td>
    <td>{{ form.cooking_41_60_cooking_oil_homemade }}</td>
    <td>{{ form.cooking_41_60_cooking_oil_other }}</td>
    <td>{{ form.cooking_41_60_saute_frequency }}</td>
    <td>{{ form.cooking_41_60_fry_frequency }}</td>
    <td>{{ form.cooking_41_60_deepfry_frequency }}</td>
  </tr>
  <tr>
    <th>Cooking 61-80 Frequency:</th>
    <th>Cooking 61-80 Frequency Times:</th>
    <th>Cooking 61-80 Fuel:</th>
    <th>Cooking 61-80 Fuel (Other):</th>
    <th>Cooking 61-80 Cooking Oil:</th>
    <th>Cooking 61-80 Cooking Oil (Store):</th>
    <th>Cooking 61-80 Cooking Oil (Homemade):</th>
    <th>Cooking 61-80 Cooking Oil (Other):</th>
    <th>Cooking 61-80 Saute Frequency:</th>
    <th>Cooking 61-80 Fry Frequency:</th>
    <th>Cooking 61-80 Deep Fry Frequency:</th>
  </tr>
  <tr>
    <td>{{ form.cooking_61_above_frequency }}</td>
    <td>{{ form.cooking_61_above_frequency_times }}</td>
    <td>{{ form.cooking_61_above_fuel }}</td>
    <td>{{ form.cooking_61_above_fuel_other }}</td>
    <td>{{ form.cooking_61_above_cooking_oil }}</td>
    <td>{{ form.cooking_61_above_cooking_oil_store }}</td>
    <td>{{ form.cooking_61_above_cooking_oil_homemade }}</td>
    <td>{{ form.cooking_61_above_cooking_oil_other }}</td>
    <td>{{ form.cooking_61_above_saute_frequency }}</td>
    <td>{{ form.cooking_61_above_fry_frequency }}</td>
    <td>{{ form.cooking_61_above_deepfry_frequency }}</td>
  </tr>
</table>


















    <!-- Volume Collected -->
    <label for="id_volume_collected">Volume Collected:</label>
    {{ form.volume_collected }}
    
    <!-- Birth Control -->

    <!-- Birth Control Duration -->

    <!-- Menopausal -->

    
    <!-- HRT Menopause -->

    
    <!-- GRT Menopause Duration -->

    
    <!-- Gender Affirming Surgery -->
    <label for="id_gender_affirming_surgery">Gender Affirming Surgery:</label>
    {{ form.gender_affirming_surgery }}
    
    <!-- Gender Affirming Type -->
    <label for="id_gender_affirming_type">Gender Affirming Type:</label>
    {{ form.gender_affirming_type }}
    
    <!-- Inhaled Medication -->
    <label for="id_inhaled_medication">Inhaled Medication:</label>
    {{ form.inhaled_medication }}
    
    <!-- Inhaled Medication Type -->

    
    <!-- Inhaled Medication Brand -->

    
    <!-- Inhaled Medication Name -->
    <label for="id_inhaled_medication_name">Inhaled Medication Name:</label>
    {{ form.inhaled_medication_name }}
    






def add_mandatory_questionaire(request, participant_id=None):
print(request.POST)

participant = None
mandatory_questionaire_data = None
print("View accessed!")
if participant_id:
    participant = get_object_or_404(Participant, participant_number=participant_id)
    mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()
    print(participant)
RelativeCancerFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)
#
if request.method == 'POST':
    form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
    formset = RelativeCancerFormSet(request.POST, prefix='relatives')

    if not participant:
        participant = Participant.objects.create(participant_number=participant_id)

    mandatory_questionaire = form.save(commit=False)
    mandatory_questionaire.participant_num = participant
    #if form.is_valid() and formset.is_valid():
    if form.is_valid():
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
        
        mandatory_questionaire = form.save(commit=False)
        mandatory_questionaire.participant_num = participant

        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
        
        mandatory_questionaire.participant_num = participant
        print("Participant to be associated:", participant)
        print("Mandatory questionnaire before save:", mandatory_questionaire.participant_num)
        mandatory_questionaire.save()

        instances = formset.save(commit=False)
        for instance in instances:
            instance.mandatory_questionaire = mandatory_questionaire
            instance.save()

        return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
    else:

        print(form.errors)
        #print(formset.errors)
else:
    print("Form is NOT valid!")  
    form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
    if mandatory_questionaire_data:
        formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.filter(mandatory_questionaire=mandatory_questionaire_data), prefix='relatives')
    else:
        formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
    #print(form.errors)

context = {
    'form': form,
    'formset': formset,
    'participant_id': participant_id,
}

#print(form.errors)
#print(formset.errors)
return render(request, 'DataEntry/mandatory_questionaire.html', context)






if participant_id is not None:
participant, _ = Participant.objects.get_or_create(participant_number=participant_id)
mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
print(f"Fetched participant: {participant}")

if request.method == 'POST':
    form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)

    if form.is_valid():
        form.instance.participant_num = participant
        print(f"Questionnaire's participant number: {form.instance.participant_num}")
        form.save()
        print(f"Saved questionnaire: {form.instance}")

        return HttpResponseRedirect(reverse('add_mandatory_questionaire_c', args=[participant_id]) + '?submitted=True')
    else:
        print(form.errors)
else:
    form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)

form_action_url = reverse('add_mandatory_questionaire_c', args=[participant_id])
else:
# Handle the case when participant_id is not provided or not valid
# You can redirect or display an error message as needed.
form = None
form_action_url = reverse('add_mandatory_questionaire_c')

context = {
'form': form,
'participant_id': participant_id,
'form_action_url': form_action_url,
}

return render(request, 'DataEntry/mandatory_questionaire_c.html', context)







def add_mandatory_questionaire_c(request, participant_id=None):
    print(f"URL Parameter - participant_id: {participant_id}")
    print(f"Participant ID: {participant_id}")
    print(f"Request method: {request.method}")
    participant = None
    mandatory_questionaire_c_data = None
    print('working here 1')
    form = Mandatory_questionaire_form_c()
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
        print(participant)
    
    if request.method == 'POST':
        form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print(f"Participant object: {participant}")
    mandatory_questionaire_c = form.save(commit=False)
    mandatory_questionaire_c.participant_num = participant
    if form.is_valid():
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print(f"Participant object: {participant}")
        mandatory_questionaire_c = form.save(commit=False)
        mandatory_questionaire_c.participant_num = participant
        print(f"Questionnaire's participant number: {mandatory_questionaire_c.participant_num}")
    else:
        print(form.errors)

    context = {
        'form': form,
        'participant_id': participant_id,
    }
    return render(request, 'DataEntry/mandatory_questionaire_c.html', context)






    <label for="studySelect">Select a study:</label>
    <select class='lower-marg'id="studySelect">
        <option value="IDEAL">IDEAL</option>
        <option value="New Study 1">New Study 1</option>
        <option value="New Study 2">New Study 2</option>
    </select>




    <li class="nav-item">
      <a class="nav-link active" aria-current="page" href="/DataEntry/add_lab_processing/{{participant_id}}">Lab</a>
  </li>






          
  <div class= >
    <label class="labels" for="{{ form.y_plasma_barcode_1.id_for_label }}">Plasma Barcode 1:</label>
    {{ form.y_plasma_barcode_1 }}
    <label class="labels" for="{{ form.y_plasma_barcode_2.id_for_label }}">Plasma Barcode 2:</label>
    {{ form.y_plasma_barcode_2 }}
    <label class="labels" for="{{ form.p_plasma_barcode_1.id_for_label }}"> Plasma Barcode 1:</label>
    {{ form.p_plasma_barcode_1 }}
    <label class="labels" for="{{ form.p_plasma_barcode_2.id_for_label }}"> Plasma Barcode 2:</label>
    {{ form.p_plasma_barcode_2 }}
  </div>
  
  <div class= >
    <label class="labels" for="{{ form.r_rbc_barcode_1.id_for_label }}"> RBC Barcode 1:</label>
    {{ form.r_rbc_barcode_1 }}
    <label class="labels" for="{{ form.r_rbc_barcode_2.id_for_label }}"> RBC Barcode 2:</label>
    {{ form.r_rbc_barcode_2 }}
  </div>
  
   <div class= >
    <label class="labels" for="{{ form.y_bottom_barcode_1.id_for_label }}"> Bottom Barcode 1:</label>
    {{ form.y_bottom_barcode_1 }}
    <label class="labels" for="{{ form.y_bottom_barcode_2.id_for_label }}">Bottom Barcode 2:</label>
    {{ form.y_bottom_barcode_2 }}
  </div>
  
   <div class= >
    <label class="labels" for="{{ form.p_bottom_barcode_1.id_for_label }}"> Bottom Barcode 1:</label>
    {{ form.p_bottom_barcode_1 }}
    <label class="labels" for="{{ form.p_bottom_barcode_2.id_for_label }}"> Bottom Barcode 2:</label>
    {{ form.p_bottom_barcode_2 }}
  </div>






  def add_exposure_form_inprogress(request, participant_id=None):
  participant = None
  exposure_data = None
  exposure_data2 = None
  exposure_data3 = None
  form = Exposure_Form(request.POST)
  form2 = Exposure_Form2(request.POST)
  form3 = Exposure_Form3(request.POST)

  if participant_id is not None:
      participant = get_object_or_404(Participant, participant_number=participant_id)
      exposure_data = Exposure.objects.filter(participant_num=participant).first()
      exposure_data2 = Exposure2.objects.filter(participant_num=participant).first()
      exposure_data3 = Exposure3.objects.filter(participant_num=participant).first()

  if request.method == 'POST':
      form = Exposure_Form(request.POST)
      form2 = Exposure_Form2(request.POST)
      form3 = Exposure_Form3(request.POST)

      if form.is_valid() and form2.is_valid() and form3.is_valid():
          exposure_instance = form.save(commit=False)
          exposure_instance.participant_num = participant
          exposure_instance.save()

          exposure2_instance = form2.save(commit=False)
          exposure2_instance.participant_num = participant
          exposure2_instance.save()

          exposure3_instance = form3.save(commit=False)
          exposure3_instance.participant_num = participant
          exposure3_instance.save()

          return redirect('/exposure_form/?submitted=True')
  else:
      print('here')

  context = {
      'form1': form,
      'form2': form2,
      'form3': form3,
  }
  return render(request, 'DataEntry/exposure_form.html', context)
#if request.method == 'POST' and 'submit' in request.POST: - same place there hashtag is




def add_mandatory_questionaire_workingAug11SAvingAllDataButRelatives(request, participant_id=None):
    print(request.POST)
    
    participant = None
    mandatory_questionaire_data = None
    print("View accessed!")
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()
        print(participant)
    RelativeCancerFormSet = modelformset_factory(biological_relatives_with_cancer, form=biological_relatives_with_cancer_form, extra=1)
    #
    if request.method == 'POST':
        form = Mandatory_questionaire_form(request.POST, instance=mandatory_questionaire_data)
        formset = RelativeCancerFormSet(request.POST, prefix='relatives')

        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)

        mandatory_questionaire = form.save(commit=False)
        mandatory_questionaire.participant_num = participant
        #if form.is_valid() and formset.is_valid():
        if form.is_valid():
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire = form.save(commit=False)
            mandatory_questionaire.participant_num = participant

            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire.participant_num = participant
            print("Participant to be associated:", participant)
            print("Mandatory questionnaire before save:", mandatory_questionaire.participant_num)
            mandatory_questionaire.save()

            instances = formset.save(commit=False)
            for instance in instances:
                instance.mandatory_questionaire = mandatory_questionaire
                instance.save()

            return HttpResponseRedirect(reverse('add_mandatory_questionaire', args=[participant_id]) + '?submitted=True')
        else:

            print(form.errors)
            #print(formset.errors)
    else:
        print("Form is NOT valid!")  
        form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
        if mandatory_questionaire_data:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.filter(mandatory_questionaire=mandatory_questionaire_data), prefix='relatives')
        else:
            formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
        #print(form.errors)

    context = {
        'form': form,
        'formset': formset,
        'participant_id': participant_id,
    }

    #print(form.errors)
    #print(formset.errors)
    return render(request, 'DataEntry/mandatory_questionaire.html', context)





    


def add_mandatory_questionaire_c_gpt(request, participant_id=None):
print(f"Participant ID from URL: {participant_id}")
print(request.POST)

participant = None
mandatory_questionaire_c_data = None
try:
    participant = Participant.objects.get(participant_number=participant_id)
    mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
    print(f"Fetched participant: {participant}")
    print(f"Fetched questionnaire data: {mandatory_questionaire_c_data}")
except ObjectDoesNotExist:
    pass
if participant_id:
    # I've corrected a typo here (from participant_num to participant_number).
    participant = get_object_or_404(Participant, participant_number=participant_id)
    mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
    print(f"Fetched participant: {participant}")
    print(f"Fetched questionnaire data: {mandatory_questionaire_c_data}")   
    form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)
else:
    participant = None
    mandatory_questionaire_c_data = None

if request.method == 'POST':
    form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)

    # Using a try-except block to catch unexpected errors during form processing.
    try:
        # If form is valid, save the participant and questionnaire data
        if form.is_valid():
            
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
                print(f"Participant object: {participant}")

            mandatory_questionaire_c = form.save(commit=False)
            mandatory_questionaire_c.participant_num = participant

            # Verifying foreign key assignment
            print(f"Questionnaire's participant number: {mandatory_questionaire_c.participant_num}")
            
            mandatory_questionaire_c.save()

            # Verifying data saving
            print(f"Saved questionnaire: {mandatory_questionaire_c}")

            return HttpResponseRedirect(reverse('add_mandatory_questionaire_c', args=[participant_id]) + '?submitted=True')
        else:
            # Printing form errors
            print(form.errors)
    except Exception as e:
        print(f"Error occurred: {e}")
else:
    # Handle GET request
    form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)

context = {
    'form': form,
    'participant_id': participant_id,
}

return render(request, 'DataEntry/mandatory_questionaire_c.html', context)





def add_mandatory_questionaire_c_notfetchingData(request, participant_id=None):
    print(f"URL Parameter - participant_id: {participant_id}")
    print(f"Participant ID: {participant_id}")
    print(f"Request method: {request.method}")
    participant = None
    mandatory_questionaire_c_data = None
    print('working here 1')
    form = Mandatory_questionaire_form_c()
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
        print(participant)
    
    if request.method == 'POST':
        form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print(f"Participant object: {participant}")
    mandatory_questionaire_c = form.save(commit=False)
    mandatory_questionaire_c.participant_num = participant
    if form.is_valid():
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print(f"Participant object: {participant}")
        mandatory_questionaire_c = form.save(commit=False)
        mandatory_questionaire_c.participant_num = participant
        print(f"Questionnaire's participant number: {mandatory_questionaire_c.participant_num}")
    else:
        print(form.errors)

    context = {
        'form': form,
        'participant_id': participant_id,
    }
    return render(request, 'DataEntry/mandatory_questionaire_c.html', context)



    

def add_mandatory_questionaire_c_workingNotSaving(request):
participant_id = request.GET.get('participant_id')  # Try to extract participant_id from GET parameters
print(f"URL Parameter - participant_id: {participant_id}")
print(f"Participant ID: {participant_id}")
print(f"Request method: {request.method}")
participant = None
mandatory_questionaire_c_data = None
print('working here')

if participant_id:
    participant = get_object_or_404(Participant, participant_number=participant_id)
    mandatory_questionaire_c_data = Mandatory_questionaire_c.objects.filter(participant_num=participant).first()
    print(f"Fetched participant: {participant}")

if request.method == 'POST':
    form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)
    print(f"Form is bound: {form.is_bound}")

    if not participant:
        participant = Participant.objects.create(participant_number=participant_id)
        print(f"Participant object: {participant}")

    form.instance.participant_num = participant

    if form.is_valid():
        print(f"Questionnaire's participant number: {form.instance.participant_num}")
        form.save()
        print(f"Saved questionnaire: {form.instance}")

        return HttpResponseRedirect(reverse('add_mandatory_questionaire_c') + f'?participant_id={participant_id}&submitted=True')
    else:
        print(form.errors)
else:
    form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)
    print(f"Form is bound: {form.is_bound}")

form_action_url = reverse('add_mandatory_questionaire_c')

context = {
    'form': form,
    'participant_id': participant_id,
    'form_action_url': form_action_url,
}

return render(request, 'DataEntry/mandatory_questionaire_c.html', context)






def add_mandatory_questionaire_de_2(request):
    form = Mandatory_questionaire_form_de(request.POST or None)
    fg_form = Mandatory_questionaire_form_fg()
    if request.method == 'POST':
        if form.is_valid():
            form.save()
            return HttpResponse('/mandatory_questionaire_de/?submitted=True')
    context = {
        'form': form,
        'fg_form': fg_form,
    }
    return render(request, 'DataEntry/mandatory_questionaire_de.html', context) #{'form': form}



    

def add_ct_scan_not_working(request, participant_id=None):
participant = None
search_query = request.GET.get('search', '')
if search_query:
    try:
        participant = Participant.objects.get(participant_number=search_query)
    except Participant.DoesNotExist:
        messages.error(request, "Participant with this number does not exist")

if participant_id:
    participant = get_object_or_404(Participant, participant_number=participant_id)

if request.method == 'POST':
    form = ParticipantForm(request.POST, instance=participant)
    form2 = CT_Scan_Form(request.POST, instance=participant)
    if form.is_valid():
        participant = form.save(commit=False)
        participant.save()
        if 'save_and_continue' in request.POST:
            return redirect('add_health', participant_id=participant.participant_number)
        elif 'save' in request.POST:
            form = ParticipantForm(instance=participant)  # Reload form with saved data
    else:
        messages.error(request, "Form is invalid")  # This is optional
else:
    form = ParticipantForm(instance=participant)

context = {
    'form': form,
    'form2': form2,
    'participant': participant,
}
return render(request, 'DataEntry/ct_scan.html', context)





def add_ct_scan_not_working(request, participant_id=None):
    participant = None
    search_query = request.GET.get('search', '')
    if search_query:
        try:
            participant = Participant.objects.get(participant_number=search_query)
        except Participant.DoesNotExist:
            messages.error(request, "Participant with this number does not exist")

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
    
    if request.method == 'POST':
        form = ParticipantForm(request.POST, instance=participant)
        form2 = CT_Scan_Form(request.POST, instance=participant)
        if form.is_valid():
            participant = form.save(commit=False)
            participant.save()
            if 'save_and_continue' in request.POST:
                return redirect('add_health', participant_id=participant.participant_number)
            elif 'save' in request.POST:
                form = ParticipantForm(instance=participant)  # Reload form with saved data
        else:
            messages.error(request, "Form is invalid")  # This is optional
    else:
        form = ParticipantForm(instance=participant)

    context = {
        'form': form,
        'form2': form2,
        'participant': participant,
    }
    return render(request, 'DataEntry/ct_scan.html', context)





    def add_ct_scan_2(request, participant_id=None):
    participant = None
    ct_scan_form = CT_Scan_Form()  # Initialize CT_Scan_Form
    ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize CT_Scan_Nodule_Form

    search_query = request.GET.get('search', '')
    if search_query:
        try:
            participant = Participant.objects.get(participant_number=search_query)
        except Participant.DoesNotExist:
            messages.error(request, "Participant with this number does not exist")

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
    
    if request.method == 'POST':
        form = ParticipantForm(request.POST, instance=participant)
        ct_scan_form = CT_Scan_Form(request.POST, instance=participant)  # Initialize CT_Scan_Form with instance
        ct_nodule_form = CT_Scan_Nodule_Form(request.POST, instance=participant)  # Initialize CT_Scan_Nodule_Form with instance

        if form.is_valid() and ct_scan_form.is_valid() and ct_nodule_form.is_valid():
            participant = form.save(commit=False)
            participant.save()
            if 'save_and_continue' in request.POST:
                return redirect('add_health', participant_id=participant.participant_number)
            elif 'save' in request.POST:
                form = ParticipantForm(instance=participant)  # Reload form with saved data
                ct_scan_form = CT_Scan_Form(instance=participant)  # Reload CT_Scan_Form with saved data
                ct_nodule_form = CT_Scan_Nodule_Form(instance=participant)  # Reload CT_Scan_Nodule_Form with saved data
        else:
            messages.error(request, "Form is invalid")  # This is optional
    else:
        form = ParticipantForm(instance=participant)

        if participant:
            ct_scan_form = CT_Scan_Form(instance=participant)  # Initialize CT_Scan_Form with instance if participant exists
            ct_nodule_form = CT_Scan_Nodule_Form(instance=participant)  # Initialize CT_Scan_Nodule_Form with instance if participant exists
        else:
            ct_scan_form = CT_Scan_Form()  # Initialize an empty CT_Scan_Form if participant doesn't exist
            ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize an empty CT_Scan_Nodule_Form if participant doesn't exist

    context = {
        'ct_scan_form': ct_scan_form,  # Use different variable names for the two forms
        'ct_nodule_form': ct_nodule_form,  # Use different variable names for the two forms
        'participant': participant,
    }
    return render(request, 'DataEntry/ct_scan.html', context)






    def add_ct_scan2(request, participant_id=None):
    participant = None
    ct_scan_form = CT_Scan_Form()  # Initialize CT_Scan_Form
    ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize CT_Scan_Nodule_Form

    search_query = request.GET.get('search', '')
    if search_query:
        try:
            participant = Participant.objects.get(participant_number=search_query)
            print("participant:", participant)
        except Participant.DoesNotExist:
            messages.error(request, "Participant with this number does not exist")

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)

        # Check if CT scan data exists for the participant and populate the form if available
        ct_scan_data = ct_scan.objects.filter(participant_num=participant).first()
        if ct_scan_data:
            # Pass the data as a dictionary to initialize the form
            ct_scan_form = CT_Scan_Form(instance=ct_scan_data)

    if request.method == 'POST':
        form = ParticipantForm(request.POST, instance=participant)
        ct_scan_form = CT_Scan_Form(request.POST, instance=ct_scan_data)
        ct_nodule_form = CT_Scan_Nodule_Form(request.POST)

        # Check if both forms are valid
        if form.is_valid() and ct_scan_form.is_valid() and ct_nodule_form.is_valid():
            # Save the participant form to create or update the participant instance
            participant = form.save()

            # Save the CT_Scan_Form data
            if ct_scan_form.has_changed():
                ct_scan_data = ct_scan_form.save(commit=False)
                ct_scan_data.participant_num = participant
                ct_scan_data.save()
                messages.success(request, "CT Scan Form saved successfully.")

            # Save the CT_Scan_Nodule_Form data
            if 'save_ct_nodule' in request.POST:
                ct_nodule_form.instance.participant_num = participant
                ct_nodule_form.save()
                messages.success(request, "CT Nodule Form saved successfully.")

            if 'save_and_continue' in request.POST:
                return redirect('add_health', participant_id=participant.participant_number)
            elif 'save' in request.POST:
                form = ParticipantForm(instance=participant)  # Reload form with saved data
                ct_scan_form = CT_Scan_Form(instance=ct_scan_data)  # Reload CT_Scan_Form with saved data
                ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize an empty CT_Scan_Nodule_Form

    else:
        form = ParticipantForm(instance=participant)
        if participant:
            # Initialize the CT_Scan_Form with data from the database if available
            ct_scan_data = ct_scan.objects.filter(participant_num=participant).first()
            if ct_scan_data:
                ct_scan_form = CT_Scan_Form(instance=ct_scan_data)
            else:
                ct_scan_form = CT_Scan_Form()  # Initialize an empty CT_Scan_Form if no data found

            ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize an empty CT_Scan_Nodule_Form if participant doesn't exist

    context = {
        'form': form,
        'ct_scan_form': ct_scan_form,
        'ct_nodule_form': ct_nodule_form,
        'participant': participant,
    }

    # Debugging Statements
    print("participant:", participant)
    print("Form Errors:", form.errors)
    print("CT Scan Form Errors:", ct_scan_form.errors)
    print("CT Nodule Form Errors:", ct_nodule_form.errors)

    return render(request, 'DataEntry/ct_scan.html', context)



    def add_ct_scan_almost_working(request, participant_id=None):
    participant = None
    ct_scan_form = CT_Scan_Form(request.POST or None)  # Initialize CT_Scan_Form
    ct_nodule_form = CT_Scan_Nodule_Form(request.POST or None)  # Initialize CT_Scan_Nodule_Form

    search_query = request.GET.get('search', '')
    if search_query:
        try:
            participant = Participant.objects.get(participant_number=search_query)
            print("participant:", participant)
        except Participant.DoesNotExist:
            messages.error(request, "Participant with this number does not exist")

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
    
    if request.method == 'POST':
        form = CT_Scan_Form(request.POST)
        ct_scan_form = CT_Scan_Nodule_Form(request.POST)

        if form.is_valid() and ct_scan_form.is_valid():
            # Assign the participant object to the participant_num field
            ct_scan = form.save(commit=False)
            ct_scan.participant_num = participant
            ct_scan.save()

        print("Request POST data:", request.POST)
        form = ParticipantForm(request.POST, instance=participant)
        ct_scan_form = CT_Scan_Form(request.POST, instance=participant)  # Initialize CT_Scan_Form with instance
        ct_nodule_form = CT_Scan_Nodule_Form(request.POST, instance=participant)  # Initialize CT_Scan_Nodule_Form with instance

        if 'participant_number' in request.POST:
            participant_number = request.POST['participant_number']
        else:
            participant_number = None

        print("participant_number:", participant_number)  # Print participant_number for debugging

        if form.is_valid() and ct_scan_form.is_valid() and ct_nodule_form.is_valid():
            if participant_number:
                form.instance.participant_number = participant_number

            participant = form.save()

            if 'save_ct_scan' in request.POST:  # Check if the "Save CT Scan Form" button was pressed
                ct_scan_form.instance.participant_number = participant_number
                ct_scan_form.save()
                messages.success(request, "CT Scan Form saved successfully.")
            elif 'save_ct_nodule' in request.POST:  # Check if the "Save CT Nodule Form" button was pressed
                ct_nodule_form.instance.participant_number = participant_number
                ct_nodule_form.save()
                messages.success(request, "CT Nodule Form saved successfully.")

            if 'save_and_continue' in request.POST:
                return redirect('add_health', participant_id=participant.participant_number)
            elif 'save' in request.POST:
                form = ParticipantForm(instance=participant)  # Reload form with saved data
                ct_scan_form = CT_Scan_Form(instance=participant)  # Reload CT_Scan_Form with saved data
                ct_nodule_form = CT_Scan_Nodule_Form(instance=participant)  # Reload CT_Scan_Nodule_Form with saved data
        else:
            messages.error(request, "Form is invalid")  # This is optional
    else:
        form = ParticipantForm(instance=participant)
       
        print("Form errors:", form.errors)
        print("CT_Scan_Form errors:", ct_scan_form.errors)
        print("CT_Scan_Nodule_Form errors:", ct_nodule_form.errors)

        if participant:
            ct_scan_form = CT_Scan_Form(instance=participant)  # Initialize CT_Scan_Form with instance if participant exists
            ct_nodule_form = CT_Scan_Nodule_Form(instance=participant)  # Initialize CT_Scan_Nodule_Form with instance if participant exists
        else:
            ct_scan_form = CT_Scan_Form()  # Initialize an empty CT_Scan_Form if participant doesn't exist
            ct_nodule_form = CT_Scan_Nodule_Form()  # Initialize an empty CT_Scan_Nodule_Form if participant doesn't exist

    context = {
        'form': form,
        'ct_scan_form': ct_scan_form,
        'ct_nodule_form': ct_nodule_form,
        'participant': participant,
    }
    print("participant:", participant)
    return render(request, 'DataEntry/ct_scan.html', context)



    def add_inclusion2(request):
    form = inclusion_form(request.POST or None, request.FILES or None)
    
    if request.method == 'POST':
        if form.is_valid():
            # Get the uploaded file
            pdf_file = request.FILES.get('pdf_file')
            form.save()
            # Save the form without committing to the database
            instance = form.save(commit=False)
            
            if pdf_file:
                # Process the uploaded file as needed
                # For example, you can save it to a specific directory
                with open('path/to/save/directory/' + pdf_file.name, 'wb') as file:
                    for chunk in pdf_file.chunks():
                        file.write(chunk)
                
                # Set the file field in the model instance
                instance.pdf_file = pdf_file
            
            # Save the form with the updated file field
            instance.save()
            
            return HttpResponse('/DataEntry/add_inclusion?submitted=True')
    
    context = {
        'form': form,
    }
    
    return render(request, 'DataEntry/inclusion.html', context)

def add_inclusion_old(request, id=None):
    if id:
        try:
            participant = Participant.objects.get(id=id)
        except Participant.DoesNotExist:
            participant = None
    else:
        participant = None

    if participant:
        form = inclusion_form(request.POST or None, request.FILES or None, instance=participant)
    else:
        form = inclusion_form(request.POST or None, request.FILES or None)

    if request.method == 'POST':
        if form.is_valid():

            pdf_file = request.FILES.get('pdf_file')
            form.save()
            instance = form.save(commit=False)

            if pdf_file:
                with open('path/to/save/directory/' + pdf_file.name, 'wb') as file:
                    for chunk in pdf_file.chunks():
                        file.write(chunk)

                instance.pdf_file = pdf_file

            instance.save()
            return HttpResponse('/DataEntry/add_inclusion?submitted=True')

    context = {
        'form': form,
    }

    return render(request, 'DataEntry/inclusion.html', context)


    

def add_inclusion_aug3(request):
form = inclusion_form(request.POST)
participant_form = ParticipantForm(request.POST)
if request.method == 'POST':
    
    if form.is_valid():
        participant_num = form.cleaned_data['participant_num']
        participant, created = Participant.objects.get_or_create(participant_number=participant_num)
        inclusion_data = form.save(commit=False)
        inclusion_data.participant_num = participant
        inclusion_data.save()
        return JsonResponse({'message': 'Inclusion form submitted successfully'})
    else:
        return JsonResponse({'error': form.errors}, status=400)
context = {
    'form': inclusion_form(),
    'participant_form': ParticipantForm(),
}
print(form.data)
print(form.errors)
print(Participant)
print(ParticipantForm)

return render(request, 'DataEntry/inclusion.html', context)





def add_inclusion_somewhatworking(request):
    if request.method == 'POST':
        participant_form = ParticipantForm(request.POST)
        form = InclusionForm(request.POST)

        if participant_form.is_valid():
            # Save the participant first
            participant = participant_form.save()

            if inclusion_form.is_valid():
                # Save the inclusion form with the participant instance
                inclusion_data = inclusion_form.save(commit=False)
                inclusion_data.participant_num = participant
                inclusion_data.save()

                # Redirect to the appropriate URL
                return redirect(f'/DataEntry/add_mandatory_questionnaire/{participant.participant_number}')
    else:
        participant_form = ParticipantForm()
        form = inclusion_form()

    context = {
        'participant_form': participant_form,
        'form': inclusion_form,
    }
    return render(request, 'DataEntry/inclusion.html', context)

def add_inclusion_old(request):
    if request.method == 'POST':
        form = inclusion_form(request.POST)
        if form.is_valid():
            participant_num = form.cleaned_data['participant_num']

            # Check if a Participant with the given participant_num already exists
            # If it doesn't exist, create a new one
            participant, created = Participant.objects.get_or_create(participant_num=participant_num)

            if created:
                # If a new Participant instance is created, save the inclusion data
                inclusion_data = form.save(commit=False)
                inclusion_data.participant_num = participant
                inclusion_data.save()
                print(participant_num)
            else:
                # If the Participant already exists, update the inclusion data
                form.instance.participant_num = participant
                form.save()
                print(participant_num)

            # Redirect to the appropriate URL
            return redirect(f'/DataEntry/add_mandatory_questionnaire/{participant_num}')

    else:
        form = inclusion_form()

    context = {
        'form': form
    }
    print(form.data)
    print(form.errors)
    
    return render(request, 'DataEntry/inclusion.html', context)







    """ 
    sweat_location = models.TextField(max_length=20)
    sweat_caps = models.TextField(max_length=20)
    da_sweat_spiked = models.TextField(max_length=20)
    da_sweat_int_std = models.TextField(max_length=20)
    da_sweat_method = models.TextField(max_length=20)
    da_sweat_date = models.TextField(max_length=20)    
    micro_int_std_sln = models.TextField(max_length=20)
    micro_int_std_vol = models.IntegerField(default=0)
    micro_hs_left = models.TextField(max_length=20)
    micro_hs_right = models.TextField(max_length=20)
    micro_extraction = models.TextField(max_length=20)
    micro_incubation = models.TextField(max_length=20)
    hs_blk_tennax = models.TextField(max_length=20)
    hs_blk_micro_num = models.IntegerField(default=0)
    hs_blk_purge = models.TextField(max_length=20)
    hs_blk_storage = models.TextField(max_length=20)
    hs_blk_caps = models.TextField(max_length=20)
    hs_blk_wbrush_tennax = models.TextField(max_length=200)
    hs_blk_wbrush_micro_num = models.IntegerField(default=0)
    hs_blk_wbrush_purge = models.TextField(max_length=20)
    hs_blk_wbrush_storage = models.TextField(max_length=20)
    hs_blk_wbrush_caps = models.TextField(max_length=20)
    hs_l_tennax = models.TextField(max_length=20)
    hs_l_micro_num = models.IntegerField(default=0)
    hs_l_purge = models.TextField(max_length=20)
    hs_l_storage = models.TextField(max_length=20)
    hs_l_caps = models.TextField(max_length=20)
    hs_r_tennax = models.TextField(max_length=20)
    hs_r_micro_num = models.IntegerField(default=0)
    hs_r_purge = models.TextField(max_length=20)
    hs_r_storage = models.TextField(max_length=20)
    hs_r_caps = models.TextField(max_length=20) 
    HTML code from the lab processing.html file:
            <div>
            <label for="id_da_sweat_location">DA Sweat Location:</label>
            {{ form.da_sweat_location }}
        </div>
        <div>
            <label for="id_da_sweat_caps">DA Sweat Caps:</label>
            {{ form.da_sweat_caps }}
        </div>
        <div>
            <label for="id_da_hs_blk_tennax">DA HS Blk Tennax:</label>
            {{ form.da_hs_blk_tennax }}
        </div>
        <div>
            <label for="id_da_hs_blk_micro_num">DA HS Blk Micro Num:</label>
            {{ form.da_hs_blk_micro_num }}
        </div>
        <div>
            <label for="id_da_hs_blk_purge">DA HS Blk Purge:</label>
            {{ form.da_hs_blk_purge }}
        </div>
        <div>
            <label for="id_da_hs_blk_storage">DA HS Blk Storage:</label>
            {{ form.da_hs_blk_storage }}
        </div>
        <div>
            <label for="id_da_hs_blk_caps">DA HS Blk Caps:</label>
            {{ form.da_hs_blk_caps }}
        </div>
        <div>
            <label for="id_da_hs_blk_wbrush_tennax">DA HS Blk Wbrush Tennax:</label>
            {{ form.da_hs_blk_wbrush_tennax }}
        </div>
        <div>
            <label for="id_da_hs_blk_wbrush_micro_num">DA HS Blk Wbrush Micro Num:</label>
            {{ form.da_hs_blk_wbrush_micro_num }}
        </div>
        <div>
            <label for="id_da_hs_blk_wbrush_purge">DA HS Blk Wbrush Purge:</label>
            {{ form.da_hs_blk_wbrush_purge }}
        </div>
        <div>
            <label for="id_da_hs_blk_wbrush_storage">DA HS Blk Wbrush Storage:</label>
            {{ form.da_hs_blk_wbrush_storage }}
        </div>
        <div>
            <label for="id_da_hs_blk_wbrush_caps">DA HS Blk Wbrush Caps:</label>
            {{ form.da_hs_blk_wbrush_caps }}
        </div>
        <div>
            <label for="id_da_hs_l_tennax">DA HS L Tennax:</label>
            {{ form.da_hs_l_tennax }}
        </div>
        <div>
            <label for="id_da_hs_l_micro_num">DA HS L Micro Num:</label>
            {{ form.da_hs_l_micro_num }}
        </div>
        <div>
            <label for="id_da_hs_l_purge">DA HS L Purge:</label>
            {{ form.da_hs_l_purge }}
        </div>
        <div>
            <label for="id_da_hs_l_storage">DA HS L Storage:</label>
            {{ form.da_hs_l_storage }}
        </div>
        <div>
            <label for="id_da_hs_l_caps">DA HS L Caps:</label>
            {{ form.da_hs_l_caps }}
        </div>
        <div>
            <label for="id_da_hs_r_tennax">DA HS R Tennax:</label>
            {{ form.da_hs_r_tennax }}
        </div>
        <div>
            <label for="id_da_hs_r_micro_num">DA HS R Micro Num:</label>
            {{ form.da_hs_r_micro_num }}
        </div>
        <div>
            <label for="id_da_hs_r_purge">DA HS R Purge:</label>
            {{ form.da_hs_r_purge }}
        </div>
        <div>
            <label for="id_da_hs_r_storage">DA HS R Storage:</label>
            {{ form.da_hs_r_storage }}
        </div>
        <div>
            <label for="id_da_hs_r_caps">DA HS R Caps:</label>
            {{ form.da_hs_r_caps }}
        </div>
        <div>
                <div>
            <label for="id_sweat_location">Sweat Location:</label>
            {{ form.sweat_location }}
        </div>
        <div>
            <label for="id_sweat_caps">Sweat Caps:</label>
            {{ form.sweat_caps }}
        </div>
        <div>
            <label for="id_micro_int_std_sln">Micro Int Std Sln:</label>
            {{ form.micro_int_std_sln }}
        </div>
        <div>
            <label for="id_micro_int_std_vol">Micro Int Std Vol:</label>
            {{ form.micro_int_std_vol }}
        </div>
        <div>
            <label for="id_micro_hs_left">Micro HS Left:</label>
            {{ form.micro_hs_left }}
        </div>
        <div>
            <label for="id_micro_hs_right">Micro HS Right:</label>
            {{ form.micro_hs_right }}
        </div>
        <div>
            <label for="id_micro_extraction">Micro Extraction:</label>
            {{ form.micro_extraction }}
        </div>
        <div>
            <label for="id_micro_incubation">Micro Incubation:</label>
            {{ form.micro_incubation }}
        </div>
        <div>
            <label for="id_hs_blk_tennax">HS Blk Tennax:</label>
            {{ form.hs_blk_tennax }}
        </div>
        <div>
            <label for="id_hs_blk_micro_num">HS Blk Micro Num:</label>
            {{ form.hs_blk_micro_num }}
        </div>
        <div>
            <label for="id_hs_blk_purge">HS Blk Purge:</label>
            {{ form.hs_blk_purge }}
        </div>
        <div>
            <label for="id_hs_blk_storage">HS Blk Storage:</label>
            {{ form.hs_blk_storage }}
        </div>
        <div>
            <label for="id_hs_blk_caps">HS Blk Caps:</label>
            {{ form.hs_blk_caps }}
        </div>
        <div>
            <label for="id_hs_blk_wbrush_tennax">HS Blk Wbrush Tennax:</label>
            {{ form.hs_blk_wbrush_tennax }}
        </div>
        <div>
            <label for="id_hs_blk_wbrush_micro_num">HS Blk Wbrush Micro Num:</label>
            {{ form.hs_blk_wbrush_micro_num }}
        </div>
        <div>
            <label for="id_hs_blk_wbrush_purge">HS Blk Wbrush Purge:</label>
            {{ form.hs_blk_wbrush_purge }}
        </div>
        <div>
            <label for="id_hs_blk_wbrush_storage">HS Blk Wbrush Storage:</label>
            {{ form.hs_blk_wbrush_storage }}
        </div>
        <div>
            <label for="id_hs_blk_wbrush_caps">HS Blk Wbrush Caps:</label>
            {{ form.hs_blk_wbrush_caps }}
        </div>
        <div>
            <label for="id_hs_l_tennax">HS L Tennax:</label>
            {{ form.hs_l_tennax }}
        </div>
        <div>
            <label for="id_hs_l_micro_num">HS L Micro Num:</label>
            {{ form.hs_l_micro_num }}
        </div>
        <div>
            <label for="id_hs_l_purge">HS L Purge:</label>
            {{ form.hs_l_purge }}
        </div>
        <div>
            <label for="id_hs_l_storage">HS L Storage:</label>
            {{ form.hs_l_storage }}
        </div>
        <div>
            <label for="id_hs_l_caps">HS L Caps:</label>
            {{ form.hs_l_caps }}
        </div>
        <div>
            <label for="id_hs_r_tennax">HS R Tennax:</label>
            {{ form.hs_r_tennax }}
        </div>
        <div>
            <label for="id_hs_r_micro_num">HS R Micro Num:</label>
            {{ form.hs_r_micro_num }}
        </div>
        <div>
            <label for="id_hs_r_purge">HS R Purge:</label>
            {{ form.hs_r_purge }}
        </div>
        <div>
            <label for="id_hs_r_storage">HS R Storage:</label>
            {{ form.hs_r_storage }}
        </div>
        <div>
            <label for="id_hs_r_caps">HS R Caps:</label>
            {{ form.hs_r_caps }}
        </div>
    """









    def add_mandatory_questionaire_de_old(request, participant_id=None):
    print(request.POST)
    print(f"URL Parameter - participant_id: {participant_id}")
    print(f"Participant ID: {participant_id}")
    print(f"Request method: {request.method}")
    participant = None
    mandatory_questionaire_de_data = None
    mandatory_questionaire_fg_data = None
    print("View accessed!")

    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_de_data = Mandatory_questionaire_de.objects.filter(participant_num=participant).first()
        mandatory_questionaire_fg_data = Mandatory_questionaire_fg.objects.filter(participant_num=participant).first()
        print(participant)

    if request.method == 'POST':
        form = Mandatory_questionaire_form_de(request.POST, instance=mandatory_questionaire_de_data)
        fg_form = Mandatory_questionaire_form_fg(request.POST, instance=mandatory_questionaire_fg_data)

        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print('created participant')
 
        if form.is_valid() and fg_form.is_valid():
            # mandatory_questionaire_de = form.save(commit=False)
            # mandatory_questionaire_de.participant_num = participant
            # mandatory_questionaire_de.save()

            # mandatory_questionaire_fg = fg_form.save(commit=False)
            # mandatory_questionaire_fg.participant_num = participant
            # mandatory_questionaire_fg.save()

            if participant_id:
                return HttpResponseRedirect(reverse('add_mandatory_questionaire_de', args=[participant_id]) + '?submitted=True')
            else:
                return HttpResponseRedirect(reverse('add_mandatory_questionaire_de') + '?submitted=True')

        else:
            print("Form DE errors:", form.errors)
            print("Form FG errors:", fg_form.errors)

    else:
        print("Form is NOT valid!")
        form = Mandatory_questionaire_form_de(request.POST, instance=mandatory_questionaire_de_data, initial={'participant_num': participant})
        fg_form = Mandatory_questionaire_form_fg(request.POST, instance=mandatory_questionaire_fg_data, initial={'participant_num': participant})

    context = {
        'form': form,
        'fg_form': fg_form,
        'participant_id': participant_id,
    }

    return render(request, 'DataEntry/mandatory_questionaire_de.html', context)




    YES_NO_DK_CHOICES = [
    (1, 'Yes'),
    (0, 'No'),
    (2, 'Don''t know')
    ]
    asbestos_exposure = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=str,
    initial=0  
    ) 
    silica_exposure = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    diesel = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    radon = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    cadmium = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    coal = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    arsenic = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    nickel = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    )
    plutonium = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 
    ) 
    ether = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    beryllium = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    chromium = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    soot = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    welding = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    radiation = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    munitions = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    warfare = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    acheson = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    aluminum = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    coke = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    )
    sulfur = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 

    mining = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    )  
    iron = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    painting = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    rubber = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    burn_pits = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    oil_fires = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    sulfur_fires = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    atsugi = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 
    sand_storms = forms.TypedChoiceField(
    choices=YES_NO_DK_CHOICES,
    widget=forms.RadioSelect(attrs={'class': 'radio'}),
    coerce=lambda x: x == 'True',
    initial=0 

    ) 



javascript for inclusion html


    <script>
        $(document).ready(function () {
            // Disable the submit button initially
            $('#submitParticipantButton').prop('disabled', true);
    
            // When the participant form is valid, enable the submit button
            $('#participantForm').on('change', function () {
                $('#submitParticipantButton').prop('disabled', !$('#participantForm')[0].checkValidity());
            });
    
            // Handle the click event of the submit button
            $('#participantForm').on('submit', function (e) {
                e.preventDefault();
                $.ajax({
                    url: '{% url "add_inclusion" %}',  // Replace with the URL to handle the participant form submission
                    type: 'post',
                    data: $('#participantForm').serialize(),
                    success: function (response) {
                        // Participant form submitted successfully, update the page content
                        $('#updateParticipantStatusFormContainer').html(response.inclusion_form);
                    },
                    error: function (error) {
                        console.log('Error submitting participant form:', error);
                    }
                });
            });
        });
        document.addEventListener("DOMContentLoaded", function () {
              const redirectToQuestionnaireButton = document.getElementById("redirectToQuestionnaireButton");
              const participantNumberInput = document.getElementById("id_participant_num");
  
              if (redirectToQuestionnaireButton && participantNumberInput) {
                  redirectToQuestionnaireButton.addEventListener("click", function () {
                      const participantNumber = participantNumberInput.value;
                      if (participantNumber) {
                          window.location.href = `/DataEntry/add_mandatory_questionnaire/${participantNumber}`;
                      }
                  });
              }
          });
    </script>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                  const submitButton = document.getElementById('submit-button');
                  const participantInput = document.querySelector('[name="participant_number"]');
          
                  submitButton.addEventListener('click', function(event) {
                      event.preventDefault();
          
                      // Get the user input
                      let inputValue = participantInput.value;
          
                      // Replace hyphen with 0
                      inputValue = inputValue.replace('-', '0');
          
                      // Update the input value
                      participantInput.value = inputValue;
          
                      // Submit the form
                      participantInput.closest('form').submit();
                  });
              });
          </script>
  


  also from inclusion View

  
  if inclusion_form_data.is_valid():
  inclusion_data = inclusion_form_data.save(commit=False)
  
  # Assume cleaned_participant_num is already prepared, e.g., '1004856'
  participant, created = Participant.objects.get_or_create(participant_number=cleaned_participant_num)
  
  inclusion_data.participant_number = participant  # Link the Participant object
  inclusion_data.save()
  
  return JsonResponse({'message': 'Inclusion form submitted successfully'})
else:
  print("Inclusion Form Errors:", inclusion_form_data.errors)
  return JsonResponse({'error': inclusion_form_data.errors}, status=400)






  def add_inclusion(request):
    if request.method == 'POST':
        participant_form = ParticipantForm(request.POST)
        #inclusion_form_data = inclusion_form(request.POST)  # Assuming 'InclusionForm' is the correct form class

        if participant_form.is_valid():
            participant_num = participant_form.cleaned_data['participant_number']
            print(participant_num)

            # Remove hyphens and replace them with '0'
            cleaned_participant_num = participant_num.replace('-', '0')
            print(cleaned_participant_num)

            # Check if the Participant instance already exists, if not, create a new one.
            participant, created = Participant.objects.get_or_create(
                participant_number=cleaned_participant_num
            )
            else:
            print("Participant Form Errors:", participant_form.errors)
            return JsonResponse({'error': participant_form.errors}, status=400)

    else:
        #inclusion_form_instance = inclusion_form()  # Assuming 'InclusionForm' is the correct form class
        participant_form = ParticipantForm()

    context = {
        #'form': inclusion_form_instance,
        'participant_form': participant_form,
    }
    return render(request, 'DataEntry/inclusion.html', context)





from mandatory quesitonaire view:
# elif 'generate_pdf' in request.GET:  # Handle the PDF generation
#     form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)
#     pdf_data = form
#     pdf_buffer = generate_mandatory_questionnaire_pdf(pdf_data)

#     response = HttpResponse(pdf_buffer, content_type='application/pdf')
#     response['Content-Disposition'] = f'attachment; filename=mandatory_questionnaire.pdf'
#     return response
# elif 'generate_pdf' in request.GET:  # Handle the PDF generation
#     print('button pressed')
#     form = Mandatory_questionaire_form(request.GET, instance=mandatory_questionaire_data)
#     if mandatory_questionaire_data:
#         print('here1')
#         formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.filter(mandatory_questionaire=mandatory_questionaire_data), prefix='relatives')
#     else:
#         print('here2')
#         formset = RelativeCancerFormSet(queryset=biological_relatives_with_cancer.objects.none(), prefix='relatives')
    
#     print('here3')
#     pdf_data = form  # Get the cleaned data
#     pdf_buffer = generate_mandatory_questionnaire_pdf(pdf_data)

#     response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
#     response['Content-Disposition'] = f'attachment; filename=mandatory_questionnaire.pdf'




# def generate_mandatory_questionnaire_pdf(pdf_data):
#     # Assuming pdf_data is a form instance
#     template_path = 'DataEntry/pdf_template.html'  # Replace with the actual path
#     template = get_template(template_path)
#     context = {'form': pdf_data}  # Pass the form instance to the template context
#     print('working here')
#     html = template.render(context)
#     pdf_buffer = BytesIO()

#     # Create a PDF from the HTML content
#     pisa_status = pisa.CreatePDF(html, dest=pdf_buffer)
#     print(pisa_status)
#     if pisa_status.err:
#         return HttpResponse('PDF generation error', content_type='text/plain')

#     response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
#     response['Content-Disposition'] = 'attachment; filename=mandatory_questionnaire.pdf'
#     pdf_buffer.close()
#     return response



# def generate_mandatory_questionnaire_pdf(pdf_data):
#     participant_num = 1234567
#     pdf_datas = {
#         'participant_num': participant_num,
#         # ... populate other data ...
#     }

#     pdf_buffer = generate_pdf(pdf_datas)  # Use the data to generate the PDF
#     # response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
#     # response['Content-Disposition'] = f'attachment; filename=mandatory_questionnaire.pdf'
#     response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
#     response['Content-Disposition'] = f'attachment; filename=mandatory_questionnaire.pdf'
#     response['Cache-Control'] = 'no-cache, no-store, must-revalidate'
#     response['Pragma'] = 'no-cache'
#     response['Expires'] = '0'

#     pdf_buffer.seek(0)  # Seek to the beginning of the buffer
#     return response






def add_mandatory_questionaire(request, participant_id=None):
    print(request.GET)  # Print the GET parameters
    
    participant = None
    mandatory_questionaire_c_data = None
    print("View accessed!")
    if participant_id:
        participant = get_object_or_404(Participant, participant_number=participant_id)
        mandatory_questionaire_c_data = Mandatory_questionaire.objects.filter(participant_num=participant).first()
        print(participant)
    
    
    if request.method == 'POST':
        form = Mandatory_questionaire_form_c(request.POST, instance=mandatory_questionaire_c_data)
        if not participant:
            participant = Participant.objects.create(participant_number=participant_id)
            print('created participant')

        if form.is_valid():
            print('form is valid')
            if not participant:
                participant = Participant.objects.create(participant_number=participant_id)
            
            mandatory_questionaire_c = form.save(commit=False)
            mandatory_questionaire_c.participant_num = participant
            mandatory_questionaire_c.save()
        else:
            print(form.errors)
            
    elif 'generate_pdf' in request.GET:  # Handle the PDF generation
        print('button pressed')
        form = Mandatory_questionaire_form_c(instance=mandatory_questionaire_c_data)  # Create a form instance with the pdf_data

        pdf_data = form.instance
        pdf_buffer = generate_mandatory_questionnaire_pdf(pdf_data, request)
        print(pdf_buffer)
        response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
        print(response)
        response['Content-Disposition'] = f'attachment; filename=mandatory_questionnaire.pdf'
        print('should be wokring here')
        return response

    else:
        print("Form is NOT valid!")
        form = Mandatory_questionaire_form(instance=mandatory_questionaire_data)

    context = {
        'form': form,
        'participant_id': participant_id,
    }

    return render(request, 'DataEntry/mandatory_questionaire.html', context)




from cs scan nodule <FORM></FORM>

</form>
</br>
</br>
</br>
<center><h3 class="line-through">CT Nodules</h3></center>
<div id="nodule-form-template">    
<form class="pink2" method="post">

{% csrf_token %}




from inclusion:

<script>
    // JavaScript function to check if participant already exists
    window.onload = function() {
        const participantAlreadyExists = "{{ participant_already_exists }}";
        
        if (participantAlreadyExists === "True") {
            alert("This participant number has already been used, please select another one");
        }
    }
</script>
<script>
  document.getElementById('navigateButton').addEventListener('click', function() {
      const participantNumber = document.getElementById('id_participant_num').value;
      const cleanedParticipantNumber = participantNumber.replace('-', '0');
      console.log("Participant Number:", participantNumber);

  });
</script>